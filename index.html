<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Updated Title -->
    <title>Kavak Culture - Wholesome Goodness, Naturally</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'brand-green': '#4A6B4C',
                        'brand-light-green': '#89A88A',
                        'brand-off-white': '#F8F7F4',
                    }
                }
            }
        }
    </script>
    <style>
        /* Simple scrollbar styling for a more modern look */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #89A88A; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #4A6B4C; }
    </style>
</head>
<body class="bg-brand-off-white text-gray-800 font-sans">

    <!-- Audio elements for each section -->
    <audio id="home-audio" src="cinematic-handpan-100bpm-25170.mp3" loop></audio>
    <audio id="about-audio" src="santoor_85_bpm-343150.mp3" loop></audio>
    <audio id="products-audio" src="birds-ambiance-204513.mp3" loop></audio>
    <audio id="visit-audio" src="nature-216798.mp3" loop></audio>
    <!-- Updated audio file path for contact section -->
    <audio id="contact-audio" src="ElevenLabs_2025-09-29T06_53_15_Aria_pre_sp100_s50_sb75_v3 (2).mp3"></audio>

    <!-- Header -->
    <header id="header" class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <a href="#home" class="flex items-center space-x-2">
                <!-- Updated alt text -->
                <img src="Gayatrilogo.jpg" alt="Kavak Culture Logo" class="h-12 w-auto">
            </a>
            <div class="hidden md:flex items-center space-x-8">
                <a href="#home" class="text-gray-600 hover:text-brand-green transition">Home</a>
                <a href="#about" class="text-gray-600 hover:text-brand-green transition">About</a>
                <a href="#products" class="text-gray-600 hover:text-brand-green transition">Products</a>
                <a href="#visit" class="text-gray-600 hover:text-brand-green transition">Book a Visit</a>
                <a href="#contact" class="text-gray-600 hover:text-brand-green transition">Contact</a>
            </div>
            <div class="flex items-center">
                <button id="mute-button" class="relative p-2 rounded-full hover:bg-gray-100 transition mr-2">
                    <!-- Mute/Unmute Icon will be inserted here by JS -->
                </button>
                <button id="cart-button" class="relative p-2 rounded-full hover:bg-gray-100 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    <span id="cart-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                </button>
                <button id="mobile-menu-button" class="md:hidden ml-4 p-2 rounded-md hover:bg-gray-100">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                    </svg>
                </button>
            </div>
        </nav>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden px-6 pt-2 pb-4 space-y-2 bg-white">
            <a href="#home" class="block text-gray-600 hover:text-brand-green transition">Home</a>
            <a href="#about" class="block text-gray-600 hover:text-brand-green transition">About</a>
            <a href="#products" class="block text-gray-600 hover:text-brand-green transition">Products</a>
            <a href="#visit" class="block text-gray-600 hover:text-brand-green transition">Book a Visit</a>
            <a href="#contact" class="block text-gray-600 hover:text-brand-green transition">Contact</a>
        </div>
    </header>

    <main>
        <!-- Home Section -->
        <section id="home" class="relative min-h-screen flex items-center justify-center bg-cover bg-center" style="background-image: url('Gayatribg.jpg');">
             <div class="absolute inset-0 bg-black/40"></div>
            <div class="relative text-center text-white p-8">
                <h1 class="text-4xl md:text-6xl font-bold mb-4 drop-shadow-lg">Straight From Our Farm to Your Table</h1>
                <!-- Updated Slogan -->
                <p class="text-lg md:text-2xl mb-8 drop-shadow-md">Kavak Culture: Wholesome Goodness, Naturally.</p>
                <a href="#products" class="bg-brand-green hover:bg-brand-light-green text-white font-bold py-3 px-8 rounded-full text-lg transition duration-300 transform hover:scale-105 shadow-lg">Explore Our Harvest</a>
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="relative py-16 md:py-24 text-white overflow-hidden">
            <video autoplay loop muted playsinline class="absolute z-0 w-auto min-w-full min-h-full max-w-none">
                <source src="Rooted with passion.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <div class="absolute inset-0 bg-brand-green/70 z-0"></div>
            <div class="container mx-auto px-6 text-center relative z-10">
                <h2 class="text-3xl md:text-4xl font-bold mb-4">Rooted in Passion, Grown with Purpose</h2>
                <p class="max-w-3xl mx-auto text-gray-200 mb-12">
                    <!-- Updated Company Name -->
                    At Kavak Culture, we're a new generation of farmers blending technology and tradition. Our passion for sustainable agriculture drives us to create eco-friendly solutions, delivering the freshest, most nutritious organic produce directly to your family. We believe in nurturing our soil and conserving resources for a healthier planet and a healthier you.
                </p>
                <div class="grid md:grid-cols-3 gap-12">
                    <div class="p-6">
                        <div class="flex items-center justify-center h-16 w-16 mx-auto mb-4 rounded-full bg-white/20">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 21a9 9 0 01-9-9 9 9 0 019-9m9 9a9 9 0 01-9 9"/></svg>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">100% Organic</h3>
                        <p class="text-gray-300">Grown naturally without synthetic pesticides or fertilizers, for pure, unadulterated flavor.</p>
                    </div>
                    <div class="p-6">
                        <div class="flex items-center justify-center h-16 w-16 mx-auto mb-4 rounded-full bg-white/20">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v16h16V4H4zm8 12l-3-3 1.5-1.5L12 13l4.5-4.5L18 10l-6 6z"/></svg>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">Sustainably Farmed</h3>
                        <p class="text-gray-300">We use data-driven techniques to conserve water, nurture soil health, and protect our ecosystem.</p>
                    </div>
                    <div class="p-6">
                         <div class="flex items-center justify-center h-16 w-16 mx-auto mb-4 rounded-full bg-white/20">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">Harvested Fresh</h3>
                        <p class="text-gray-300">Hand-picked at the peak of freshness to ensure the best taste and nutritional value for you.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Products Section -->
        <section id="products" class="py-16 md:py-24 bg-white">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl md:text-4xl font-bold text-center text-brand-green mb-12">Our Fresh, Organic Offerings</h2>
                <!-- Product list will be dynamically inserted here from Supabase -->
                <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                    <!-- Loading Spinner (optional, but good UX) -->
                    <div id="products-loading" class="sm:col-span-2 lg:col-span-4 text-center text-gray-500">
                        <svg class="animate-spin h-8 w-8 text-brand-green mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p class="mt-2">Loading our fresh harvest...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Book a Visit Section (Updated for Calendly) -->
        <section id="visit" class="py-16 md:py-24">
            <div class="container mx-auto px-6">
                <div class="max-w-3xl mx-auto bg-white rounded-2xl shadow-lg p-8 md:p-12 text-center">
                    <h2 class="text-3xl md:text-4xl font-bold text-center text-brand-green mb-4">Come See How the Goodness Grows!</h2>
                    <!-- Updated Company Name -->
                    <p class="text-center text-gray-600 mb-8">Experience the magic of organic farming firsthand. Book a tour of the Kavak Culture farm today.</p>
                    <a href="https://calendly.com/sachingayatri-mali/30min" target="_blank" rel="noopener noreferrer" class="inline-block w-full max-w-xs bg-brand-green hover:bg-brand-light-green text-white font-bold py-3 px-8 rounded-lg transition duration-300 transform hover:scale-105">
                        Schedule Your Visit
                    </a>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="py-16 md:py-24 bg-white">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl md:text-4xl font-bold text-center text-brand-green mb-12">Get In Touch</h2>
                <div class="flex flex-col md:flex-row gap-12">
                    <div class="md:w-1/2">
                        <iframe src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d238.37966251325892!2d74.87107979906773!3d17.069003286582323!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2sin!4v1759124528625!5m2!1sen!2sin" width="100%" height="350" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade" class="rounded-lg"></iframe>
                    </div>
                    <div class="md:w-1/2 flex flex-col justify-center">
                        <div class="space-y-6">
                            <div class="flex items-start space-x-4">
                                <div class="bg-brand-light-green/20 p-3 rounded-full text-brand-green"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg></div>
                                <div>
                                    <h4 class="font-semibold text-lg">Our Location</h4>
                                    <!-- Updated Location -->
                                    <p class="text-gray-600">Kuchi, Sangli, Maharashtra 416405, India</p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-4">
                                <div class="bg-brand-light-green/20 p-3 rounded-full text-brand-green"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg></div>
                                <div>
                                    <h4 class="font-semibold text-lg">Email Us</h4>
                                    <!-- Updated Email -->
                                    <p class="text-gray-600">teammo.and.co@gmail.com</p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-4">
                                <div class="bg-brand-light-green/20 p-3 rounded-full text-brand-green"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg></div>
                                <div>
                                    <h4 class="font-semibold text-lg">Call Us</h4>
                                    <!-- Updated Phone -->
                                    <p class="text-gray-600">+91 7498017600</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-brand-green text-white">
        <div class="container mx-auto px-6 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <!-- Updated Copyright -->
                <p>&copy; 2025 Kavak Culture. All Rights Reserved.</p>
                <div class="flex space-x-4 mt-4 md:mt-0">
                    <a href="#" class="hover:text-brand-light-green transition">Facebook</a>
                    <a href="#" class="hover:text-brand-light-green transition">Instagram</a>
                    <a href="#" class="hover:text-brand-light-green transition">Twitter</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Cart Modal -->
    <div id="cart-modal" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center">
        <div id="cart-modal-content" class="bg-white rounded-lg shadow-xl w-full max-w-lg mx-4 transform transition-all opacity-0 -translate-y-10">
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-5 border-b">
                <h3 class="text-xl font-semibold text-gray-800">Your Shopping Cart</h3>
                <button id="close-cart-button" class="text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            <!-- Modal Body -->
            <div id="cart-items" class="p-5 max-h-96 overflow-y-auto">
                <!-- Cart items will be here -->
                <p id="cart-empty-message" class="text-center text-gray-500">Your cart is empty.</p>
            </div>
            <!-- Modal Footer -->
            <div id="cart-footer" class="p-5 border-t">
                 <div class="flex justify-between items-center font-bold text-lg mb-4">
                     <span>Total</span>
                     <span id="cart-total">₹0.00</span>
                 </div>
                 <button class="w-full bg-brand-green hover:bg-brand-light-green text-white font-bold py-3 rounded-lg transition duration-300">Proceed to Checkout</button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification-toast" class="fixed bottom-5 right-5 bg-brand-green text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-[120%] transition-transform duration-500 ease-in-out">
        Notification message
    </div>


    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- SUPABASE CLIENT INITIALIZATION ---
            const SUPABASE_URL = 'https://rdgibagwcenwthrcsllp.supabase.co'; 
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJkZ2liYWd3Y2Vud3RocmNzbGxwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExMDE5MTIsImV4cCI6MjA3NjY3NzkxMn0.d5CthwkuclqKk1z7gjwsgaP0P53q2dFya5k5fRNAxAY';

            if (!window.supabase) {
                console.error("Supabase client library is not loaded.");
                alert("Error: Could not connect to the database. Please check your internet connection and try again.");
                return;
            }
            
            const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);


            // --- DATA ---
            let products = [];
            let cart = [];

            // --- ELEMENTS ---
            const productList = document.getElementById('product-list');
            const productsLoading = document.getElementById('products-loading');
            const cartButton = document.getElementById('cart-button');
            const cartModal = document.getElementById('cart-modal');
            const cartModalContent = document.getElementById('cart-modal-content');
            const closeCartButton = document.getElementById('close-cart-button');
            const cartItemsContainer = document.getElementById('cart-items');
            const cartCount = document.getElementById('cart-count');
            const cartTotal = document.getElementById('cart-total');
            const cartEmptyMessage = document.getElementById('cart-empty-message');
            const cartFooter = document.getElementById('cart-footer');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const notificationToast = document.getElementById('notification-toast');

            // --- AUDIO ---
            const muteButton = document.getElementById('mute-button');
            const allAudio = document.querySelectorAll('audio');
            let isMuted = true;
            let currentAudio = null; 
            let audioUnlocked = false; 
            const unmuteIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/></svg>`;
            const muteIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" clip-rule="evenodd" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2 2m2-2l2 2" /></svg>`;

            // --- FUNCTIONS ---
            
            async function fetchProducts() {
                const { data, error } = await supabaseClient
                    .from('products') // Assuming you fixed the case-sensitivity issue in Supabase
                    .select('*');

                if (error) {
                    console.error('Error fetching products:', error);
                    productList.innerHTML = `<p class="text-red-500 text-center col-span-full">Error loading products. Please try again later.</p>`;
                    if(productsLoading) productsLoading.classList.add('hidden');
                    return;
                }

                products = data;
                renderProducts();
            }

            function showNotification(message) {
                notificationToast.textContent = message;
                notificationToast.classList.remove('translate-x-[120%]');
                setTimeout(() => {
                    notificationToast.classList.add('translate-x-[120%]');
                }, 3000); 
            }

            function renderProducts() {
                if(productsLoading) productsLoading.classList.add('hidden');
                productList.innerHTML = ''; 
                
                if (products.length === 0) {
                     productList.innerHTML = `<p class="text-gray-500 text-center col-span-full">No products are available at this time.</p>`;
                     return;
                }
                
                products.forEach(product => {
                    // Check for case-sensitivity on price
                    const price = product.price || product.Price || 0; 
                    const name = product.name || product.Name || 'Unnamed Product';
                    const description = product.description || product.Description || 'No description available.';
                    
                    const productCard = `
                        <div class="bg-white rounded-lg shadow-md overflow-hidden transform hover:-translate-y-2 transition duration-300">
                            <img src="${product.image}" alt="${name}" class="w-full h-48 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x300/EAF0E5/4A6B4C?text=${encodeURIComponent(name)}';">
                            <div class="p-6">
                                <h3 class="text-xl font-semibold mb-2">${name}</h3>
                                <p class="text-gray-500 mb-4">${description}</p>
                                <div class="flex justify-between items-center">
                                    <span class="text-lg font-bold text-brand-green">₹${price.toFixed(2)}/pack</span>
                                    <button data-product-id="${product.id}" class="add-to-cart-btn bg-brand-green text-white px-4 py-2 rounded-full hover:bg-brand-light-green transition text-sm font-semibold">
                                        Add to Cart
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    productList.innerHTML += productCard;
                });
            }

            function updateCartUI() {
                cartItemsContainer.innerHTML = '';
                if (cart.length === 0) {
                    cartEmptyMessage.classList.remove('hidden');
                    cartFooter.classList.add('hidden');
                } else {
                    cartEmptyMessage.classList.add('hidden');
                    cartFooter.classList.remove('hidden');
                    cart.forEach(item => {
                        const price = item.price || item.Price || 0;
                        const name = item.name || item.Name || 'Unnamed Product';
                        
                        const cartItemHTML = `
                            <div class="flex items-center justify-between py-4 border-b last:border-b-0">
                                <div class="flex items-center space-x-4">
                                    <img src="${item.image}" alt="${name}" class="w-16 h-16 object-cover rounded-md" onerror="this.onerror=null;this.src='https://placehold.co/100x100/EAF0E5/4A6B4C?text=${encodeURIComponent(name)}';">
                                    <div>
                                        <h4 class="font-semibold">${name}</h4>
                                        <p class="text-sm text-gray-500">₹${price.toFixed(2)}</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <button data-id="${item.id}" class="quantity-change-btn p-1 rounded-full bg-gray-200 hover:bg-gray-300">-</button>
                                    <span>${item.quantity}</span>
                                    <button data-id="${item.id}" class="quantity-change-btn p-1 rounded-full bg-gray-200 hover:bg-gray-300">+</button>
                                    <button data-id="${item.id}" class="remove-item-btn text-red-500 hover:text-red-700">&times;</button>
                                </div>
                            </div>
                        `;
                        cartItemsContainer.innerHTML += cartItemHTML;
                    });
                }

                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                cartCount.textContent = totalItems;

                const totalPrice = cart.reduce((sum, item) => {
                    const price = item.price || item.Price || 0;
                    return sum + price * item.quantity;
                }, 0);
                cartTotal.textContent = `₹${totalPrice.toFixed(2)}`;
            }

            function addToCart(productId) {
                const product = products.find(p => p.id === productId);
                if (!product) {
                    console.error("Product not found:", productId);
                    return;
                }
                
                const cartItem = cart.find(item => item.id === productId);
                const name = product.name || product.Name || 'Product';

                if (cartItem) {
                    cartItem.quantity++;
                } else {
                    cart.push({ ...product, quantity: 1 });
                }
                updateCartUI();
                showNotification(`Added ${name} to cart!`);
            }
            
            function changeQuantity(productId, operation) {
                const cartItem = cart.find(item => item.id === productId);
                if (!cartItem) return;
                
                if (operation === '+') {
                    cartItem.quantity++;
                } else if (operation === '-') {
                    cartItem.quantity--;
                    if (cartItem.quantity === 0) {
                        removeItem(productId);
                    }
                }
                updateCartUI();
            }
            
            function removeItem(productId) {
                cart = cart.filter(item => item.id !== productId);
                updateCartUI();
            }

            function showCartModal() {
                cartModal.classList.remove('hidden');
                setTimeout(() => {
                    cartModalContent.classList.remove('opacity-0', '-translate-y-10');
                    cartModalContent.classList.add('opacity-100', 'translate-y-0');
                }, 10);
            }
            
            function hideCartModal() {
                 cartModalContent.classList.add('opacity-0', '-translate-y-10');
                 cartModalContent.classList.remove('opacity-100', 'translate-y-0');
                 setTimeout(() => cartModal.classList.add('hidden'), 300);
            }
            
            function updateMuteButton() {
                muteButton.innerHTML = isMuted ? muteIcon : unmuteIcon;
            }

            function pauseAllAudio() {
                allAudio.forEach(audio => {
                    audio.pause();
                    audio.currentTime = 0;
                });
            }

            // --- EVENT LISTENERS ---
            productList.addEventListener('click', (e) => {
                if (e.target.classList.contains('add-to-cart-btn')) {
                    const productId = parseInt(e.target.dataset.productId);
                    addToCart(productId);
                }
            });

            cartItemsContainer.addEventListener('click', e => {
                const target = e.target;
                
                const removeBtn = target.closest('.remove-item-btn');
                if (removeBtn) {
                    const productId = parseInt(removeBtn.dataset.id);
                    removeItem(productId);
                    return;
                }

                const quantityBtn = target.closest('.quantity-change-btn');
                if(quantityBtn) {
                    const productId = parseInt(quantityBtn.dataset.id);
                    const operation = quantityBtn.textContent;
                    changeQuantity(productId, operation);
                    return;
                }
            });

            cartButton.addEventListener('click', showCartModal);
            closeCartButton.addEventListener('click', hideCartModal);
            cartModal.addEventListener('click', (e) => {
                if (e.target === cartModal) {
                    hideCartModal();
                }
            });

            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
            
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetElement = document.querySelector(this.getAttribute('href'));
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                    if (!mobileMenu.classList.contains('hidden')) {
                         mobileMenu.classList.add('hidden');
                    }
                });
            });

            muteButton.addEventListener('click', () => {
                if (!audioUnlocked) {
                    allAudio.forEach(audio => {
                        const playPromise = audio.play();
                        if (playPromise !== undefined) {
                            playPromise.then(_ => {
                                audio.pause();
                            }).catch(error => {
                                console.log("Audio unlock play failed for one audio, this is normal.", error);
                            });
                        }
                    });
                    audioUnlocked = true;
                    console.log("Audio unlocked by user interaction.");
                }

                isMuted = !isMuted;
                // --- FIX 1 ---
                updateMuteButton(); 

                if (isMuted) {
                    pauseAllAudio();
                } else {
                    if (currentAudio) {
                        currentAudio.play().catch(e => console.error("Audio play failed:", e));
                    }
                }
            });
            
            const sections = document.querySelectorAll('main section');
            const observerOptions = {
                root: null,
                rootMargin: '0px',
                threshold: 0.5 
            };

            const sectionObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const audioId = `${entry.target.id}-audio`;
                    const audio = document.getElementById(audioId);
                    if (!audio) return;

                    if (entry.isIntersecting) {
                        pauseAllAudio();
                        currentAudio = audio;
                        // --- TYPO FIX ---
                        // Changed isMMuted to isMuted
                        if (!isMuted && audioUnlocked) {
                            currentAudio.currentTime = 0;
                            currentAudio.play().catch(e => console.error("Autoplay was prevented.", e));
                        }
                    }
                });
            }, observerOptions);

            sections.forEach(section => {
                sectionObserver.observe(section);
            });


            // --- INITIALIZATION ---
            fetchProducts();
            updateCartUI();
            
            // --- FIX 2 ---
            updateMuteButton();

        });
    </script>
</body>
</html>

